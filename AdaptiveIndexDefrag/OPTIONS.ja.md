注)  本文書は英語から翻訳したものであり、その内容が最新でない場合もあります。最新の情報はオリジナルの英語版を参照してください。

**AdaptiveIndexDefrag で利用可能なパラメータ**

- **@Exec_Print** デフォルトは 1 (このSPによって生成されたSQLコードを実行する) またはオプションで 0 (コマンドを単にプリントする) です。
- **@printCmds** デフォルトは 0 (一部のコマンドのみ画面に表示) またはオプションで 1 (すべてのコマンドを画面に表示) です。 実行されるコマンドを見たい場合に便利です。
- **@outputResults** デフォルトは 0 (断片化情報を出力しない) またはオプションで 1 (実行完了後に断片化情報を出力する) です。
- **@debugMode** デフォルトは 0 (デバッグコメントを表示しない) またはオプションで 1 (デバッグコメントを表示する) です。
- **@timeLimit** インデックスのデフラグの実行に費やす時間を制限します。 単位は分です。 インデックスのデフラグが始まる前に制限時間がチェックされるため、一つのインデックスのデフラグに時間がかかる場合は制限時間を超えることがあります。 デフォルトは 480 分 (8 時間) です。
- **@dbScope** デフラグするデータベース名を指定します。 これを指定しないと、システムデータベース以外のすべてのデータベースと msdb と model がデフラグされます。
- **@tblName** 特定のテーブルのインデックスのみをデフラグするかどうかを指定します。 入力形式は schema.table_name です。 指定しない場合、すべてのテーブルのデフラグが行われます。
- **@defragOrderColumn** デフラグの優先順位を決める方法を定義します。 @Exec_Print が 1 に設定されている場合にのみ有効です。 デフォルトは range_scan_count (インデックススキャンとテーブルスキャンの回数です。これが最もデフラグによる恩恵があります) 、他のオプションは、 fragmentation (インデックス内の断片化の度合い) と page_count (インデックス内のページ数) があります。
- **@defragSortOrder** デフラグの優先順位について、@defragOrderColumn で使用する ORDER BY 句のソート順を定義します。 オプションは ASC (昇順) または DESC (降順) です。 DESC がデフォルトです。
- **@forceRescan** デフォルトは 0で、全てのインデックスのデフラグが完了するまで再スキャンは行われません (これにより、デフラグは複数の期間に渡って実行されます)。 他のオプションは 1 で、これは再スキャンを強制します。
- **@defragDelay** デフラグコマンド間の待機時間を指定します。 デフォルト値は 5 秒です。 次のパラメータ群のドキュメントについては、 [Reorganizing and Rebuilding Indexes](https://docs.microsoft.com/sql/relational-databases/indexes/reorganize-and-rebuild-indexes) ([日本語ページ](https://msdn.microsoft.com/ja-jp/library/ms189858.aspx)) を参照してください。
- **@ixtypeOption** デフォルトは NULL です (すべてのインデックスがデフラグされます) 。 その他のオプションは、1 (クラスタ化インデックスのみ) または 0 (XML および空間インデックスを含む非クラスタ化インデックスのみ) です。
- **@minFragmentation** デフォルトは 5% です。 断片化率がこれより低い場合はデフラグされません。
- **@rebuildThreshold** デフォルトは 30% です。 30% を超えると、再構成の代わりに再構築が行われます。
- **@rebuildThreshold_cs** デフォルトは 10% です。 10% を超えると、列ストアが再構築されます。
- **@minPageCount** デフラグの対象と判断するための、インデックスに存在する最小ページ数を指定します。 デフォルトは 1 エクステント (8 ページ) です。
- **@maxPageCount** デフラグの対象と判断するための、インデックスに存在する最大ページ数を指定します。 営業時間中に小さなインデックスを、非営業時間に大きなインデックスをスケジューリングする場合に役立ちます。
- **@fillfactor** デフォルトは 1 (インデックスが作成されたときの元のフィルファクターまたは最後に最適化されたときのフィルファクター) またはオプションの 0 (既定のフィルファクター 0 を使用) です。
- **@scanMode** フラグメンテーションレベルを決定するために使用するスキャンモードを指定します。 LIMITEDモードがデフォルトです。 最小ページ数をスキャンします。 インデックスの場合、B ツリーの親レベルのページ (つまり、リーフレベルの上のページ) のみがスキャンされます。 ヒープでは、関連する PFS ページと IAM ページのみが検査されます。 ヒープのデータページはスキャンされません。 その他のオプションには、SAMPLED (インデックスまたはヒープ内のすべてのページの 1 パーセントのサンプルに基づく統計を返す) または DETAILED (すべてのページをスキャンしてすべての統計を返す。パフォーマンスの問題を引き起こす可能性あり) があります。 インデックスまたはヒープのページ数が 10,000 ページ未満の場合、SAMPLED ではなく DETAILED モードが自動的に使用されます。
- **@onlineRebuild** デフォルトは 0 (オフラインリビルド) またはオプションで 1 (可能であればオンラインリビルド) です。
- **@sortInTempDB** デフォルトは 0 (インデックスのデータベースで並べ替え操作を実行する) またはオプションで 1 (TempDB で並べ替え操作を実行する) です。 ソート操作が必要ない場合、またはメモリー内でソートを実行できる場合は、SORT_IN_TEMPDB は無視されます。 このオプションを1に設定すると、デフラグが速くなり、データベースファイルのサイズが大きくなるのを防ぐことができます。 注意点は、TempDB を入念に監視する必要があることです。
- **@maxDopRestriction** インデックス再構築のプロセッサ制限を指定します。 指定されていない場合、デフラグ操作はシステムの MaxDOP 設定で動きます。ただし最大値は8に制限されます。
- **@updateStats** デフォルトは 1 (再編成時に統計を更新する) またはオプションで 0 (再編成時に統計を更新しない) です。
- **@updateStatsWhere** デフォルトは 0 (テーブル全体のすべての統計を更新) またはオプションで 1 (インデックス関連の統計のみを更新) です。 統計を更新することを選択し、@scanMode オプションが LIMITED モード**でない**場合でも、特定のしきい値内のもののみが更新されます。 統計の自動更新のデフォルト値を確認するには、 [Statistical maintenance functionality (autostats) in SQL Server](https://support.microsoft.com/help/195565/statistical-maintenance-functionality-autostats-in-sql-server) を参照してください。
- **@statsSample** デフォルトは NULL (ターゲットのテーブルまたはインデックス付きビューでサンプル・スキャンを実行し、データベース・エンジンが必要なサンプル・サイズを自動的に計算する) 、またはオプションの FULLSCAN (表またはビュー内の全ての行を読んで統計を収集する)  または RESAMPLE  (インデックスを含む既存の全ての統計について継承されたサンプリング比を使用して統計を収集する) です。
- **@ix_statsnorecomp** デフォルトは 0 (STATISTICS_NORECOMPUTE OFF で実行) です 。 オプション STATISTICS_NORECOMPUTE の詳細は、[ALTER INDEX (Transact-SQL)](https://docs.microsoft.com/en-us/sql/t-sql/statements/alter-index-transact-sql) ([日本語ページ](https://msdn.microsoft.com/ja-jp/library/ms188388.aspx)) を参照してください。 必要に応じて1を使用します (STATISTICS_NORECOMPUTE で実行すると、インデックス関連の統計情報の自動更新が無効になります)。 カスタムジョブで統計更新を扱っている場合 (またはこのコードで統計を更新する場合でも)、このオプションを使用することができます。
- **@statsIncremental** デフォルトは NULL です。 1 の場合、作成される統計はパーティションごとの統計です。 0 の場合、統計情報ツリーは削除され、SQL Server は統計情報を再計算します。 この設定は、データベースレベルの INCREMENTAL プロパティをオーバーライドします。 (訳注: 1 にするとパーティション分割されていないテーブルについても INCREMENTAL = ON を指定するので処理に失敗する)
- **@dealMaxPartition**  (インデックスがパーティション化されている場合) 最も右側に配置されたパーティションを除外するか、あるいは最も右側に配置されたパーティションのみを対象 (その他のパーティションは除外) にするかを指定します。 通常、最も右側に配置されたパーティションは、スライディングウィンドウのシナリオ上では、現在書き込まれているパーティションになります。 この機能を有効にすると、競合を減らすことができます。 これは、他のタイプの分割シナリオでは適用できないことがあります。 非パーティション化インデックスはこのオプションの影響を受けません。 このパラメータのデフォルトは0 (最も右端に配置されたパーティションのみがデフラグされる) です。 パーティションが @minPageCount より小さい場合、それは考慮されません。 その他のオプションは、1 (最も右に配置されたパーティションを除外する) または NULL (すべてのパーティションがデフラグされる) です。
- **@dealLOB** ラージ・オブジェクト (LOB) データを含むすべてのページを圧縮するかどうかを指定します。 LOB のデータ型は、image、text、ntext、varchar(max)、nvarchar(max)、varbinary(max) および xml です。 これらのデータを圧縮すると、ディスク領域の使用を改善できます。 クラスタ化インデックスを再編成すると、クラスタ化インデックスに含まれるすべての LOB 列が圧縮されます。 非クラスター化インデックスを再編成すると、インデックスの非キー (インクルード) 列であるすべての LOB 列が圧縮されます。 デフォルトは 0 (再編成時に LOB を圧縮する) です。オプションは 1 (再編成時に LOB を圧縮しない) です。
- **@ignoreDropObj** デフラグ・サイクルが開始された後で、テーブルまたはインデックスが削除された場合、全体の結果としてそれらに起因するエラーを無視するかどうかを指定します。 無視するとした場合、エラーの内容が、削除されたデータベースオブジェクトを参照したことだけである場合は、ジョブは失敗になりません。 デフォルトは0 (デフラグサイクルの開始以降に削除されたオブジェクトに関するエラーを含める) で、オプションは 1 (エラーレポート用。デフラグサイクルが開始されてからオブジェクトが削除されたという事実は無視される) です。
- **@disableNCIX** 再構築の前に非クラスタ化インデックスを無効にするかどうかを指定します。 ディスク容量が限られている場合は、非クラスタ化インデックスを再構築する前にインデックスを無効にすると便利です。 非クラスタ化インデックスを無効にしない場合、再構築処理には古いインデックスと新しいインデックスの両方を格納するのに十分な一時的なディスク領域が必要です。 しかし、非クラスタ化インデックスを個別のトランザクションで無効にして再構築すると、インデックスを無効にすることで使用可能になったディスク領域を、後の再構築またはその他の操作で再利用できます。 従って、ソート用の一時的なディスク領域 (SQL Server Books Online によれば、これは通常、インデックスサイズの 20% です) を除いて、追加の領域は必要ありません。 既存のパーティションのサブセットのデフラグ時に、パーティション化テーブルのインデックスを無効にしないことに注意して下さい。 また、このプロシージャは、デフラグ・サイクルによって無効にされたインデックスを記録します。 デフラグがキャンセルされた場合は、次回の実行時にこれらの無効化されたインデックスが考慮されます。 デフォルトは 0 (再構築前に非クラスタ化インデックスを無効にしない) で、オプションは 1 (再構築前に非クラスタ化インデックスを無効にする) です。
- **@offlinelocktimeout** インデックスのオフラインリビルド時のロック・タイムアウト時間を秒単位で指定します。
- **@onlinelocktimeout** 低優先度で待機してロックを取得するまでのタイムアウト時間を分単位で指定します。 これは SQL Server 2014 以降で有効です。
- **@abortAfterwait** @onlinelocktimeout 経過後のアクションを設定します。 このパラメータのデフォルトは NULL (ロック・タイムアウトが発生した後、通常優先度でロックを待機し続ける) です。 オプションは0 (オンラインでのインデックス再構築 DDL の操作をブロックするすべてのユーザー・トランザクションを強制終了させ、操作を続行できるようにする) と 1 (現在実行されているオンラインでのインデックス再構築 DDL の操作を何もせずに終了させる) です。
- **@dealROWG** COMPRESS_ALL_ROW_GROUPS (訳注: 原文誤りを修正) オプションを設定して、閉じられた行グループだけでなく、すべての行グループを圧縮します。
